---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

interface FacilityImageSlot {
  label: string;
  suggestedFile?: string;
  image?: CollectionEntry<"facilitiesCollection">["data"]["imageSlots"][number]["image"];
}

interface FacilityItem {
  id: string;
  name: string;
  tagline: string;
  description: string;
  features: string[];
  activities: string[];
  imageSlots: FacilityImageSlot[];
}

interface Props {
  facilities: FacilityItem[];
}

const { facilities } = Astro.props;
const totalImageSlots = facilities.reduce((count, facility) => count + facility.imageSlots.length, 0);
---

<section class="section pt-10 md:pt-12">
  <div class="section-inner">
    <div class="surface p-6 md:p-8">
      <div class="grid gap-6 md:grid-cols-3">
        <div>
          <p class="eyebrow">Campus Snapshot</p>
          <p class="mt-3 text-3xl font-semibold text-foreground md:text-4xl">{facilities.length}</p>
          <p class="mt-1 text-sm text-muted-foreground">Learning and activity facilities</p>
        </div>
        <div>
          <p class="eyebrow">Image Planning</p>
          <p class="mt-3 text-3xl font-semibold text-foreground md:text-4xl">{totalImageSlots}</p>
          <p class="mt-1 text-sm text-muted-foreground">Total photo slots prepared</p>
        </div>
        <div>
          <p class="eyebrow">Coverage</p>
          <p class="mt-3 text-3xl font-semibold text-foreground md:text-4xl">100%</p>
          <p class="mt-1 text-sm text-muted-foreground">All listed facilities included on this page</p>
        </div>
      </div>
    </div>

    <div class="mt-10 flex flex-wrap gap-3">
      {facilities.map((facility) => (
        <a
          href={`#${facility.id}`}
          class="inline-flex items-center rounded-full border border-border bg-background px-4 py-2 text-sm font-medium text-foreground transition hover:bg-secondary"
        >
          {facility.name}
        </a>
      ))}
    </div>

    <div class="mt-10 space-y-8 md:space-y-10">
      {facilities.map((facility) => (
        <article id={facility.id} class="surface p-5 md:p-7 scroll-mt-28">
          <div class="grid gap-7 lg:grid-cols-[1.05fr_1fr]">
            <div>
              <p class="eyebrow">Facility</p>
              <h2 class="mt-3 text-2xl font-semibold text-foreground md:text-3xl">{facility.name}</h2>
              <p class="mt-4 text-base font-medium text-foreground">{facility.tagline}</p>
              <p class="mt-3 text-muted-foreground">{facility.description}</p>

              <div class="mt-6 grid gap-5 md:grid-cols-2">
                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.18em] text-muted-foreground">Key Features</h3>
                  <ul class="mt-3 space-y-2.5">
                    {facility.features.map((feature) => (
                      <li class="flex items-start gap-2.5 text-sm text-foreground">
                        <span class="mt-2 h-1.5 w-1.5 rounded-full bg-primary"></span>
                        <span>{feature}</span>
                      </li>
                    ))}
                  </ul>
                </div>

                <div>
                  <h3 class="text-sm font-semibold uppercase tracking-[0.18em] text-muted-foreground">Common Uses</h3>
                  <ul class="mt-3 space-y-2.5">
                    {facility.activities.map((activity) => (
                      <li class="flex items-start gap-2.5 text-sm text-foreground">
                        <span class="mt-2 h-1.5 w-1.5 rounded-full bg-primary"></span>
                        <span>{activity}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-semibold uppercase tracking-[0.18em] text-muted-foreground">Facility Photos</h3>
              <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2">
                {facility.imageSlots.map((slot) => (
                  <div class="surface p-3">
                    {slot.image ? (
                      <Image
                        src={slot.image}
                        alt={slot.label}
                        class="aspect-4/3 w-full rounded-xl object-cover"
                        width={960}
                        height={720}
                      />
                    ) : (
                      <div class="flex aspect-4/3 items-center justify-center rounded-xl border border-dashed border-border bg-secondary/70 p-4 text-center">
                        <div>
                          <p class="text-xs text-muted-foreground">Image coming soon</p>
                        </div>
                      </div>
                    )}
                    <p class="mt-3 text-sm font-semibold text-foreground">{slot.label}</p>
                    {!slot.image && slot.suggestedFile && (
                      <p class="mt-1 text-xs text-muted-foreground">Suggested file: {slot.suggestedFile}</p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </article>
      ))}
    </div>
  </div>
</section>
