---
import { Icon } from "astro-icon/components";
import { ICONS } from "../data/icons";
import type { IconKey } from "../data/icons";

interface Props {
    title: string;
    lead: string;
    items: {
        label: string;
        value: string;
        detail?: string;
        icon?: IconKey;
    }[];
}

const { title, lead, items } = Astro.props;
---

<section class="section">
    <div class="section-inner grid gap-10 lg:grid-cols-[1.05fr_0.95fr]">
        <div>
            <p class="eyebrow">Proof</p>
            <h2 class="section-title mt-3">{title}</h2>
            <p class="section-lead">{lead}</p>
            <div class="mt-8 surface p-6">
                <p class="text-sm text-muted-foreground">Recent highlights</p>
                <ul class="mt-4 space-y-3 text-sm text-foreground">
                    <li class="flex items-center gap-2">
                        <Icon name={ICONS.trophy} class="h-[18px] w-[18px] text-primary" aria-hidden="true" />
                        National STEM competitions and Olympiad placements.
                    </li>
                    <li class="flex items-center gap-2">
                        <Icon name={ICONS.handshake} class="h-[18px] w-[18px] text-primary" aria-hidden="true" />
                        University partnerships and research mentorship.
                    </li>
                    <li class="flex items-center gap-2">
                        <Icon name={ICONS.certificate} class="h-[18px] w-[18px] text-primary" aria-hidden="true" />
                        Full and partial scholarships for top performers.
                    </li>
                </ul>
            </div>
        </div>

        <div class="grid gap-4 sm:grid-cols-2">
            {items.map((item) => (
                <div class="surface p-6 text-left">
                    <div class="flex items-center gap-2 text-sm text-muted-foreground">
                        {item.icon && (
                            <Icon name={ICONS[item.icon]} class="h-[18px] w-[18px]" aria-hidden="true" />
                        )}
                        <span>{item.label}</span>
                    </div>
                    <p class="mt-2 text-3xl font-semibold text-foreground counter" data-value={item.value}>
                        0
                    </p>
                    {item.detail && <p class="mt-2 text-sm text-muted-foreground">{item.detail}</p>}
                </div>
            ))}
        </div>
    </div>
</section>

<script>
    const animateCounters = () => {
        document.querySelectorAll('.counter').forEach((el) => {
            const target = parseInt((el as HTMLElement).dataset.value || '0', 10) || 0;
            const duration = 2000;
            const start = Date.now();

            const animate = () => {
                const elapsed = Date.now() - start;
                const progress = Math.min(elapsed / duration, 1);
                el.textContent = String(Math.floor(target * progress));
                if (progress < 1) requestAnimationFrame(animate);
            };
            animate();
        });
    };

    animateCounters();
</script>