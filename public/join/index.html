<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Join STEM Gharbiya Github</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://challenges.cloudflare.com" />
    <script>
      const getTheme = () => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        return "dark";
      };
      document.documentElement.classList.toggle("dark", getTheme() === "dark");
    </script>
    <script
      src="https://challenges.cloudflare.com/turnstile/v0/api.js"
      async
      defer
    ></script>
  </head>
  <body>
    <button class="theme-toggle" id="themeToggle">
      <span id="themeIcon">ðŸŒ™</span>
    </button>

    <div class="container">
      <div class="card">
        <div class="header">
          <h1 class="title">Join STEM Gharbiya GitHub</h1>
          <p class="description">
            Apply to join our organization and collaborate on projects
          </p>
        </div>

        <div id="alertsContainer"></div>

        <form id="applicationForm">
          <div class="form-group">
            <label for="fullName" class="required">Full Name</label>
            <input type="text" id="fullName" name="fullName" required />
            <div class="error" id="nameError"></div>
          </div>

          <div class="form-group">
            <label for="schoolEmail" class="required">School Email</label>
            <input type="email" id="schoolEmail" name="schoolEmail" required />
            <span class="hint">Must end with @stemgharbiya.moe.edu.eg</span>
            <div class="error" id="emailError"></div>
          </div>

          <div class="form-group">
            <label for="githubUsername" class="required">GitHub Username</label>
            <input
              type="text"
              id="githubUsername"
              name="githubUsername"
              required
            />
            <div class="error" id="githubError"></div>
          </div>

          <div class="form-group">
            <label for="seniorYear" class="required">Senior Year</label>
            <input
              type="text"
              id="seniorYear"
              name="seniorYear"
              pattern="^[Ss](2[5-9]|30)$"
              title="Format: S25, S26, S27, S28, S29, or S30 only"
              placeholder="S25, S26, S27, etc."
              required
            />
            <span class="hint"
              >Format: S followed by graduation year (S25-S30 only)</span
            >
            <div class="error" id="seniorYearError"></div>
          </div>

          <div class="form-group">
            <label class="required">Interests</label>
            <div class="checkbox-group" id="interestsContainer"></div>
            <div class="error" id="interestsError"></div>
          </div>

          <div class="form-group">
            <label for="motivation" class="required">Motivation</label>
            <textarea
              id="motivation"
              name="motivation"
              rows="4"
              required
            ></textarea>
            <span class="hint"
              >Why do you want to join? (10-500 characters)</span
            >
            <div class="error" id="motivationError"></div>
          </div>

          <div class="form-group">
            <label class="required agreement-label"
              >Code of Conduct Agreement</label
            >
            <div class="checkbox-item">
              <input type="checkbox" id="agreement" name="agreement" required />
              <label for="agreement">
                I agree to follow the organization's
                <a
                  href="https://github.com/stemgharbiya/.github/blob/main/CODE_OF_CONDUCT.md"
                  target="_blank"
                  rel="noopener noreferrer"
                  >Code of Conduct</a
                >
              </label>
            </div>
            <div class="error" id="agreementError"></div>
          </div>
          <div
            class="cf-turnstile"
            data-sitekey="0x4AAAAAACYCSDOBa1wv0RmS"
            data-theme="auto"
            data-callback="onTurnstileSuccess"
            data-error-callback="onTurnstileError"
            data-expired-callback="onTurnstileExpired"
          ></div>

          <button type="submit" class="btn" id="submitBtn" disabled>
            <span id="submitText">Submit Application</span>
          </button>
        </form>

        <div class="footer">
          <p>
            <a
              href="https://github.com/stemgharbiya/join/issues/new"
              target="_blank"
              rel="noopener noreferrer"
              >Have a problem?</a
            >
          </p>
          <p class="rate-limit-note">
            To prevent spam, you can only submit one application per minute per
            school email. If you get a "Too many requests" message, please wait
            a minute before trying again.
          </p>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
    <script>
      function onTurnstileSuccess(token) {
        if (token && typeof token === "string" && token.trim().length > 0) {
          document.getElementById("submitBtn").disabled = false;
        } else {
          document.getElementById("submitBtn").disabled = true;
        }
      }
      function onTurnstileError(errorCode) {
        console.error("Turnstile error:", errorCode);
        document.getElementById("submitBtn").disabled = true;
        showAlert(
          "error",
          "Verification Failed",
          "Please complete the security check again.",
        );
      }
      function onTurnstileExpired() {
        document.getElementById("submitBtn").disabled = true;
        showAlert(
          "warning",
          "Verification Expired",
          "Please complete the security check again.",
        );
      }
    </script>
  </body>
</html>
